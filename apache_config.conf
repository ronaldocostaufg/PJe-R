# Configuração Apache para FolhaFácil - Sistema Completo
# Inclui: folhafacil (projeto principal), Horas e Monitor

# ============================================================================
# CONFIGURAÇÃO HTTP (PORTA 80)
# ============================================================================
<VirtualHost *:80>
    ServerName seu-dominio.com
    ServerAlias www.seu-dominio.com
    DocumentRoot /var/www/html
    
    # Redirecionar HTTP para HTTPS (recomendado para produção)
    # Redirect permanent / https://seu-dominio.com/
    
    # Arquivos estáticos e media
    Alias /static/ /caminho/para/seu/projeto/staticfiles/
    Alias /media/ /caminho/para/seu/projeto/media/
    
    <Directory /caminho/para/seu/projeto/staticfiles>
        Require all granted
    </Directory>
    
    <Directory /caminho/para/seu/projeto/media>
        Require all granted
    </Directory>
    
    # Configuração WSGI para Django
    WSGIDaemonProcess folhafacil python-path=/caminho/para/seu/projeto:/caminho/para/seu/venv/lib/python3.x/site-packages
    WSGIProcessGroup folhafacil
    WSGIScriptAlias / /caminho/para/seu/projeto/folhafacil/wsgi.py
    
    <Directory /caminho/para/seu/projeto/folhafacil>
        <Files wsgi.py>
            Require all granted
        </Files>
    </Directory>
    
    # Logs
    ErrorLog ${APACHE_LOG_DIR}/folhafacil_error.log
    CustomLog ${APACHE_LOG_DIR}/folhafacil_access.log combined
</VirtualHost>

# ============================================================================
# CONFIGURAÇÃO HTTPS (PORTA 443) - RECOMENDADO PARA PRODUÇÃO
# ============================================================================
<VirtualHost *:443>
    ServerName seu-dominio.com
    ServerAlias www.seu-dominio.com
    DocumentRoot /var/www/html
    
    # Certificados SSL (substitua pelos seus)
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/seu-dominio.crt
    SSLCertificateKeyFile /etc/ssl/private/seu-dominio.key
    SSLCertificateChainFile /etc/ssl/certs/seu-dominio-chain.crt
    
    # Configurações de segurança SSL
    SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384
    SSLHonorCipherOrder on
    SSLCompression off
    
    # Headers de segurança
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    Header always set X-Frame-Options DENY
    Header always set X-Content-Type-Options nosniff
    Header always set X-XSS-Protection "1; mode=block"
    
    # Arquivos estáticos e media
    Alias /static/ /caminho/para/seu/projeto/staticfiles/
    Alias /media/ /caminho/para/seu/projeto/media/
    
    <Directory /caminho/para/seu/projeto/staticfiles>
        Require all granted
    </Directory>
    
    <Directory /caminho/para/seu/projeto/media>
        Require all granted
    </Directory>
    
    # Configuração WSGI para Django
    WSGIDaemonProcess folhafacil python-path=/caminho/para/seu/projeto:/caminho/para/seu/venv/lib/python3.x/site-packages
    WSGIProcessGroup folhafacil
    WSGIScriptAlias / /caminho/para/seu/projeto/folhafacil/wsgi.py
    
    <Directory /caminho/para/seu/projeto/folhafacil>
        <Files wsgi.py>
            Require all granted
        </Files>
    </Directory>
    
    # Logs
    ErrorLog ${APACHE_LOG_DIR}/folhafacil_ssl_error.log
    CustomLog ${APACHE_LOG_DIR}/folhafacil_ssl_access.log combined
</VirtualHost>

# ============================================================================
# CONFIGURAÇÕES ADICIONAIS
# ============================================================================

# Habilitar módulos necessários
# Certifique-se de que estes módulos estão habilitados:
# sudo a2enmod ssl
# sudo a2enmod rewrite
# sudo a2enmod headers
# sudo a2enmod wsgi

# Configurações de performance
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Cache para arquivos estáticos
<IfModule mod_expires.c>
    ExpiresActive on
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/ico "access plus 1 year"
    ExpiresByType image/icon "access plus 1 year"
    ExpiresByType text/plain "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
</IfModule>
