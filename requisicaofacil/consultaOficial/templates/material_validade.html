{% load static %}
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Materiais por Validade</title>
    <link rel="stylesheet" href="{% static 'requisicaofacil/css/material_pesquisa.css' %}">
    <style>
        /* ================================== */
        /* === RESET E ESTILOS GLOBAIS === */
        /* ================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Inter", sans-serif;
        }

        body {
            background-color: #f8f9fa;
        }

        /* ================================== */
        /* === COMPONENTES DE NAVEGAÇÃO === */
        /* ================================== */

        /* --- BARRA DE NAVEGAÇÃO SUPERIOR --- */
        .nav-menu-bar {
            background-color: #000000c6;
            width: 100%;
            position: sticky;
            top: 0;
            left: 0;
            z-index: 1000;
        }

        .header-container1 {
            max-width: 1300px;
            height: 50px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .nav {
            display: flex;
            align-items: center;
        }

        .nav-list {
            display: flex;
            list-style: none;
            gap: 30px;
        }

        .nav-list a {
            text-decoration: none;
            color: #f5f5f5;
            font-weight: 500;
            font-size: 16px;
            transition: color 0.3s;
        }

        .nav-list a:hover {
            color: #ffffff;
        }

        /* --- CABEÇALHO PRINCIPAL --- */
        .header {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0 20px;
            background-color: #fff;
        }

        .header-container {
            width: 100%;
            max-width: 1300px;
            margin-top: 50px;
            height: 90px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .logo-container {
            font-size: 42px;
            font-weight: 600;
        }

        .divider {
            width: 100%;
            height: 1px;
            background-color: black;
            max-width: 1300px;
        }

        /* --- MENU HAMBÚRGUER (MOBILE) --- */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
        }

        .hamburger {
            display: flex;
            width: 25px;
            height: 3px;
            background-color: #f5f5f5;
            position: relative;
            transition: all 0.3s;
        }

        .hamburger::before,
        .hamburger::after {
            content: '';
            position: absolute;
            width: 25px;
            height: 3px;
            background-color: #f5f5f5;
            transition: all 0.3s;
        }

        .hamburger::before {
            top: -8px;
        }

        .hamburger::after {
            bottom: -8px;
        }

        /* ================================== */
        /* === CONTAINER PRINCIPAL E FILTROS === */
        /* ================================== */
        .consulta-container {
            max-width: 1340px;
            margin: 0 auto;
            padding: 20px;
            padding-top: 10px;
            background-color: #fff;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        /* --- CABEÇALHO DOS FILTROS (BOTÕES) --- */
        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-bottom: 20px;
        }

        .instruction-text {
            color: #3E3E3E;
            font-size: 18px;
            font-weight: 500;
            text-align: center;
        }

        .instruction-text#mobile {
            display: none;
        }
        
        /* --- GRUPOS DE FILTROS --- */
        .main-filters {
            justify-content: space-between;
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            min-width: 250px;
            flex: 1;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 20px;
        }

        .quantity-filter {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-filter select,
        .quantity-filter input {
            font-size: 16px;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #032b2e29;
        }

        .quantity-filter select {
            padding-right: 24px;
        }

        .quantity-filter input[type="number"] {
            width: 100px;
        }
        
        .search-input {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-input .search-icon {
            width: 20px;
            height: 20px;
            position: absolute;
            left: 10px;
            color: #666;
            cursor: pointer;
        }

        .search-input input,
        .search-input textarea {
            font-size: 16px;
            width: 100%;
            padding: 8px 8px 8px 35px;
            border-radius: 20px;
            border: 1px solid #ccc;
        }

        /* ================================== */
        /* === BOTÕES ESTILIZADOS === */
        /* ================================== */
        .filter-btn {
            --width: 208px;
            --height: 39px;
            --tooltip-height: 40px;
            --tooltip-width: 110px;
            --gap-between-tooltip-to-button: 18px;
            width: var(--width);
            height: var(--height);
            position: relative;
            text-align: center;
            border-radius: 7px;
            font-family: inherit;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            overflow: hidden;
            border: none;
        }

        .filter-btn::before {
            position: absolute;
            content: attr(data-tooltip);
            width: var(--tooltip-width);
            height: var(--tooltip-height);
            background-color: #555;
            color: #fff;
            font-size: 14px;
            border-radius: 7px;
            line-height: var(--tooltip-height);
            bottom: calc(var(--height) + var(--gap-between-tooltip-to-button) + 10px);
            left: calc(50% - var(--tooltip-width) / 2);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s;
        }
        
        .filter-btn .button-wrapper,
        .filter-btn .text,
        .filter-btn .icon {
            overflow: hidden;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            color: #3E3E3E;
        }

        .filter-btn .text {
            top: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: top 0.5s;
        }

        .filter-btn .icon {
            color: #fff;
            top: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: top 0.5s;
        }

        .filter-btn:hover .text { top: -100%; }
        .filter-btn:hover .icon { top: 0; }
        .filter-btn:hover::before {
            opacity: 1;
            visibility: visible;
            bottom: calc(var(--height) + var(--gap-between-tooltip-to-button));
        }

        .apply-btn { background: #ffffff; border: 2px solid #09475C; }
        .apply-btn:hover { background: #09475C; }
        .apply-btn::before { content: "Filtrar resultados"; width: 130px; left: calc(50% - 65px); }

        .clear-btn { background: #ffffff; border: 2px solid #3E3E3E; }
        .clear-btn:hover { background: #3E3E3E; }
        .clear-btn::before { content: "Resetar filtros"; }


        /* ================================== */
        /* === TABELA DE RESULTADOS === */
        /* ================================== */
        .results-table {
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
            width: 100%;
        }

        .table-header,
        .table-row {
            display: flex;
            padding: 10px 0;
        }

        .table-header {
            font-weight: bold;
            border-bottom: 2px solid #032b2e;
            color: #000000;
        }

        .table-row {
            cursor: pointer;
            border-bottom: 1px solid #e9ecef;
            transition: background-color 0.2s;
            align-items: center;
        }

        .table-row:hover {
            background-color: #f0f0f0;
        }
        
        .table-row.expired {
            color: #dc3545; /* Cor vermelha para alerta */
            background-color: #f8d7da; /* Fundo vermelho claro */
        }
        
        .table-row.expired:hover {
            background-color: #f5c6cb; /* Fundo vermelho um pouco mais escuro no hover */
        }

        .no-results {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #6c757d;
        }

        .col-cod, .col-desc, .col-dias-vencido, .col-data-vencimento {
            padding: 0 10px;
            text-align: left;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .col-cod { flex: 0 0 150px; display: flex; align-items: center; gap: 8px; }
        .col-desc { flex: 1; min-width: 200px; }
        .col-dias-vencido { flex: 0 0 180px; }
        .col-data-vencimento { flex: 0 0 180px; }

        .copy-svg { cursor: pointer; }

        /* ================================== */
        /* === PAGINAÇÃO E MENSAGENS === */
        /* ================================== */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            list-style: none;
            padding: 0;
        }

        .page-item .page-link {
            padding: 8px 15px;
            border: 1px solid #ccc;
            background-color: #f5f5f5;
            cursor: pointer;
            border-radius: 4px;
            color: black;
            text-decoration: none;
            display: flex;
            align-items: center;
        }
        .page-item .page-link:hover {
            background-color: #e0e0e0;
        }
        
        .page-item.disabled .page-link {
            opacity: 0.7;
            cursor: not-allowed;
            background-color: #e9ecef;
        }
        
        #page-input-direct {
            width: 60px;
            text-align: center;
            font-size: 16px;
            margin: 0 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            padding: 5px;
        }

        .error-message {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            font-size: 16px;
            padding: 15px;
            border-radius: 8px;
            width: fit-content;
            margin: 20px auto;
        }
        
        /* ================================== */
        /* === MODAL === */
        /* ================================== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay:not(.hidden) {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 20px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .modal-header h3 { font-size: 20px; font-weight: 500; color: #09475C; }
        .modal-header button { background: none; border: none; cursor: pointer; padding: 5px; }
        .modal-divider { height: 1px; background-color: #dee2e6; margin: 10px 0; }

        .modal-content { display: flex; flex-direction: column; gap: 5px; }

        .modal-row {
            display: flex;
            padding: 15px 10px;
            border-radius: 4px;
        }
        .modal-row:nth-child(odd) { background-color: #f8f9fa; }
        .modal-row > span:first-child { font-weight: bold; min-width: 150px; }
        
        .modal-row.full-width { flex-direction: column; }
        .modal-row.full-width > span:first-child { margin-bottom: 10px; }
        
        #modal-descricao {
            padding: 10px;
            width: 100%;
            height: 180px;
            resize: vertical;
            border: 1px solid #ced4da;
            border-radius: 4px;
            background-color: #fff;
        }

        /* ================================== */
        /* === RESPONSIVIDADE === */
        /* ================================== */
        @media (max-width: 992px) {
            .main-filters { flex-direction: column; }
        }

        @media (max-width: 768px) {
            .header-container1 { justify-content: flex-end; }
            .logo-container { font-size: 28px; }
            .header-container { margin-top: 20px; height: auto; }

            .instruction-text { display: none; }
            .instruction-text#mobile { display: block; font-size: 16px; }

            .filter-header { flex-direction: column; gap: 10px; }
            .filter-btn { width: 100%; }
            
            .table-header { display: none; }
            .table-row {
                flex-direction: column;
                align-items: flex-start;
                padding: 15px;
                border: 1px solid #dee2e6;
                border-radius: 8px;
                margin-bottom: 10px;
            }
            .table-row > div::before {
                content: attr(data-label);
                font-weight: bold;
                margin-right: 10px;
                min-width: 150px;
                display: inline-block;
            }
            .col-cod, .col-desc, .col-dias-vencido, .col-data-vencimento {
                display: flex;
                align-items: center;
                width: 100%;
                white-space: normal;
                flex: 1;
            }

            .pagination { flex-wrap: wrap; }
            
            .menu-toggle { display: block; z-index: 1001; }
            .nav { position: fixed; top: 0; right: -100%; width: 80%; max-width: 300px; height: 100vh; background-color: #020202; transition: right 0.3s; padding: 80px 20px; z-index: 1000; }
            .nav.active { right: 0; }
            .nav-list { flex-direction: column; }
            .menu-toggle.active .hamburger { background-color: transparent; }
            .menu-toggle.active .hamburger::before { transform: rotate(45deg); top: 0; }
            .menu-toggle.active .hamburger::after { transform: rotate(-45deg); bottom: 0; }
        }
    </style>
</head>

<body>

    <nav class="nav-menu-bar">
        <div class="header-container1">
            <button class="menu-toggle" aria-label="Abrir menu">
                <span class="hamburger"></span>
            </button>
            <nav class="nav">
                <ul class="nav-list">
                    <li><a href="{% url 'consultaOficial:material_pesquisa' %}">Início</a></li>
                    <li><a href="{% url 'consultaOficial:material_validade' %}">Materiais com data de vencimento</a></li>
                </ul>
            </nav>
        </div>
    </nav>

    <header class="header">
        <div class="header-container">
            <div class="logo-container">Requisição Fácil</div>
        </div>
        <div class="divider"></div>
    </header>

    <div class="consulta-container">
        <form method="GET" action="" id="filter-form">
            <div class="filter-header">
                <button type="button" class="filter-btn clear-btn" id="clear-filters-btn" data-tooltip="Resetar filtros">
                    <div class="button-wrapper">
                        <div class="text">Limpar filtros</div>
                        <span class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13.013 3H2l8 9.46V19l4 2v-8.54l.9-1.055" /><path d="m22 3-5 5" /><path d="m17 3 5 5" /></svg>
                        </span>
                    </div>
                </button>
                <p id='mobile' class="instruction-text">Clique na linha para ver detalhes</p>
                <p class="instruction-text">Clique na linha para ver os detalhes completos<br />Clique no código para copiar</p>
                <button type="submit" class="filter-btn apply-btn" data-tooltip="Filtrar resultados">
                    <div class="button-wrapper">
                        <div class="text">Aplicar filtro</div>
                        <span class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="24" height="24" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z" /></svg>
                        </span>
                    </div>
                </button>
            </div>

            <div class="main-filters">
                <div class="filter-group">
                    <label>Filtro de código</label>
                    <div class="search-input">
                        <span class="search-icon submit-on-click">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g> <path d="M15.7955 15.8111L21 21M18 10.5C18 14.6421 14.6421 18 10.5 18C6.35786 18 3 14.6421 3 10.5C3 6.35786 6.35786 3 10.5 3C14.6421 3 18 6.35786 18 10.5Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                        </span>
                        <input type="number" name="codigo" placeholder="Pesquisar por código..." value="{{ request.GET.codigo }}">
                    </div>
                </div>
                <div class="filter-group">
                    <label>Filtro de descrição</label>
                    <div class="search-input">
                        <span class="search-icon submit-on-click">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g> <path d="M15.7955 15.8111L21 21M18 10.5C18 14.6421 14.6421 18 10.5 18C6.35786 18 3 14.6421 3 10.5C3 6.35786 6.35786 3 10.5 3C14.6421 3 18 6.35786 18 10.5Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                        </span>
                        <input type="text" name="descricao" placeholder="Pesquisar por descrição..." value="{{ request.GET.descricao }}">
                    </div>
                </div>
                <div class="filter-group">
                    <label>Dias para vencer</label>
                    <div class="quantity-filter">
                        <select name="prazoValidade_filter">
                            <option value="menorq" {% if request.GET.prazoValidade_filter == 'menorq' %}selected{% endif %}>Menor ou igual a</option>
                            <option value="maiorq" {% if request.GET.prazoValidade_filter == 'maiorq' %}selected{% endif %}>Maior ou igual a</option>
                            <option value="igual" {% if request.GET.prazoValidade_filter == 'igual' %}selected{% endif %}>Igual a</option>
                        </select>
                        <input type="number" name="prazoValidade" placeholder="Dias" value="{{ request.GET.prazoValidade }}">
                    </div>
                </div>
            </div>
            <input type="hidden" name="page" id="page-input-hidden" value="{{ page_obj.number }}">
        </form>

        {% if messages %}
            {% for message in messages %}
                {% if message.level == 40 %}
                    <div class="error-message">{{ message }}</div>
                {% endif %}
            {% endfor %}
        {% endif %}

        <div class="results-table">
            <div class="table-header">
                <div class="col-cod">Código</div>
                <div class="col-desc">Descrição</div>
                <div class="col-dias-vencido">Dias p/ Vencer</div>
                <div class="col-data-vencimento">Data de Vencimento</div>
            </div>

            {% if page_obj.object_list|length == 0 %}
                <div class="no-results">Nenhum material encontrado com os filtros aplicados.</div>
            {% else %}
                {% for material in page_obj %}
                <div class="table-row {% if material.prazoPassadoLinha < 0 %}expired{% endif %}"
                     data-codigo="{{ material.codigo }}"
                     data-descricao="{{ material.descricao }}"
                     data-dias-vencido="{{ material.prazoPassadoLinha }}"
                     data-validade="{{ material.dataValidade }}">
                    <div class="col-cod" data-label="Código:">
                        <span class="material-code">{{ material.codigo }}</span>
                        <svg class='copy-svg' width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                    </div>
                    <div class="col-desc" data-label="Descrição:">{{ material.descricao|truncatechars:100 }}</div>
                    <div class="col-dias-vencido" data-label="Dias p/ Vencer:">
                        {% if material.prazoPassadoLinha < 0 %}
                           Vencido há {{ material.dias_vencido_abs }} dia(s)
                        {% else %}
                            {{ material.prazoPassadoLinha }} dia(s)
                        {% endif %}
                    </div>
                    <div class="col-data-vencimento" data-label="Vencimento:">{{ material.dataValidade }}</div>
                </div>
                {% endfor %}
            {% endif %}
        </div>
        
        {% if page_obj and page_obj.paginator.num_pages > 1 %}
        <nav>
            <ul class="pagination">
                {% if page_obj.has_previous %}
                    <li class="page-item"><a class="page-link" href="?page=1{{ request.GET.urlencode }}">&laquo;&laquo;</a></li>
                    <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}{{ request.GET.urlencode }}">&laquo;</a></li>
                {% endif %}
                <li class="page-item disabled">
                    <span class="page-link">
                        Página
                        <input type="number" min="1" max="{{ page_obj.paginator.num_pages }}" value="{{ page_obj.number }}" id="page-input-direct">
                        de {{ page_obj.paginator.num_pages }}
                    </span>
                </li>
                {% if page_obj.has_next %}
                    <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}{{ request.GET.urlencode }}">&raquo;</a></li>
                    <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{{ request.GET.urlencode }}">&raquo;&raquo;</a></li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    </div>
    
    <div class="modal-overlay hidden" id="product-modal">
        <div class="modal" onclick="(e) => e.stopPropagation()">
            <div class="modal-header">
                <h3>Detalhes do Material</h3>
                <button id="close-modal-btn" aria-label="Fechar modal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg>
                </button>
            </div>
            <div class="modal-divider"></div>
            <div class="modal-content">
                <div class="modal-row">
                    <span>Código:</span>
                    <span id="modal-codigo" class="material-code"></span>
                    <svg class='copy-svg' style="margin-left: 8px;" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                </div>
                <div class="modal-row">
                    <span>Data de Vencimento:</span>
                    <span id="modal-validade"></span>
                </div>
                <div class="modal-row">
                    <span>Dias para Vencer:</span>
                    <span id="modal-dias-vencido"></span>
                </div>
                <div class="modal-row full-width">
                    <span>Descrição Completa:</span>
                    <textarea id="modal-descricao" readOnly></textarea>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- ELEMENTOS DO DOM ---
            const filterForm = document.getElementById('filter-form');
            const clearFiltersBtn = document.getElementById('clear-filters-btn');
            const pageInputDirect = document.getElementById('page-input-direct');
            const modalOverlay = document.getElementById('product-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            
            // --- FUNÇÃO REUTILIZÁVEL PARA ANIMAÇÃO DE CÓPIA ---
            function handleCopyAnimation(clickedElement) {
                const parentDiv = clickedElement.parentElement;
                const codeSpan = parentDiv.querySelector('.material-code');
                if (!codeSpan) return;

                const codeToCopy = codeSpan.innerText.trim();
                navigator.clipboard.writeText(codeToCopy).then(() => {
                    const feedbackMessage = document.createElement('span');
                    feedbackMessage.textContent = 'Copiado! ✓';
                    feedbackMessage.style.color = '#28a745';
                    feedbackMessage.style.fontWeight = 'bold';
                    feedbackMessage.style.fontSize = '0.9em';
                    
                    const copyIcon = parentDiv.querySelector('.copy-svg');
                    
                    codeSpan.style.display = 'none';
                    if (copyIcon) copyIcon.style.display = 'none';
                    parentDiv.insertBefore(feedbackMessage, copyIcon);

                    setTimeout(() => {
                        feedbackMessage.remove();
                        codeSpan.style.display = 'inline';
                        if (copyIcon) copyIcon.style.display = 'inline';
                    }, 2000);
                }).catch(err => console.error('Falha ao copiar:', err));
            }

            // --- MANIPULADORES DE EVENTOS ---
            
            // Limpar filtros
            clearFiltersBtn.addEventListener('click', () => {
                window.location.href = window.location.pathname;
            });

            // Ir para página específica
            pageInputDirect?.addEventListener('change', function (e) {
                const page = e.target.value;
                const urlParams = new URLSearchParams(window.location.search);
                urlParams.set('page', page);
                window.location.search = urlParams.toString();
            });

            // Enviar formulário ao clicar nos ícones de busca
            document.querySelectorAll('.submit-on-click').forEach(icon => {
                icon.addEventListener('click', () => filterForm.submit());
            });

            // Abrir o modal com dados da linha
            document.querySelectorAll('.table-row').forEach(row => {
                row.addEventListener('click', (e) => {
                    if (e.target.closest('.col-cod')) return; // Não abre modal se clicar na área do código
                    
                    // Populando o modal
                    document.getElementById('modal-codigo').textContent = row.dataset.codigo;
                    document.getElementById('modal-validade').textContent = row.dataset.validade;
                    document.getElementById('modal-descricao').value = row.dataset.descricao;

                    const diasVencido = parseInt(row.dataset.diasVencido, 10);
                    const diasEl = document.getElementById('modal-dias-vencido');
                    if (diasVencido < 0) {
                        diasEl.textContent = `Vencido há ${Math.abs(diasVencido)} dia(s)`;
                        diasEl.style.color = '#dc3545';
                    } else {
                        diasEl.textContent = `${diasVencido} dia(s)`;
                        diasEl.style.color = 'inherit';
                    }
                    
                    modalOverlay.classList.remove('hidden');
                });
            });

            // Fechar o modal
            closeModalBtn.addEventListener('click', () => modalOverlay.classList.add('hidden'));
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) modalOverlay.classList.add('hidden');
            });

            // Aplicar função de cópia a todos os ícones de cópia
            document.querySelectorAll('.copy-svg').forEach(icon => {
                icon.addEventListener('click', function (event) {
                    event.stopPropagation();
                    handleCopyAnimation(this);
                });
            });

            // Lógica do menu hambúrguer para mobile
            const menuToggle = document.querySelector('.menu-toggle');
            const nav = document.querySelector('.nav');
            if (menuToggle && nav) {
                menuToggle.addEventListener('click', function () {
                    this.classList.toggle('active');
                    nav.classList.toggle('active');
                });
            }
        });
    </script>
</body>
</html>